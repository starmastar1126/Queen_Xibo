{
  "dbVersion": 160,
  "appVersion": "1.9.0-alpha1",
  "steps": [
    {
      "step": "Update Playlist with RegionId",
      "action": "ALTER TABLE `playlist` ADD regionId INT DEFAULT NULL  NULL;"
    },
    {
      "step": "Update existing Regions with their PlaylistId",
      "action": "UPDATE `playlist` SET regionId = (SELECT MAX(regionId) FROM lkregionplaylist WHERE playlist.playlistId = lkregionplaylist.playlistId);"
    },
    {
      "step": "Remove old link table",
      "action": "DELETE TABLE `lkregionplaylist`;"
    },
    {
      "step": "Allow Playlist as a Home Page",
      "action": "UPDATE `pages` SET asHome = 1 WHERE name = 'playlist';"
    },
    {
      "step": "Create Playlist Tag link table",
      "action": "CREATE TABLE IF NOT EXISTS `lktagplaylist` (`lkTagPlaylistId` int(11) NOT NULL AUTO_INCREMENT,`tagId` int(11) NOT NULL,`playlistId` int(11) NOT NULL,PRIMARY KEY (`lkTagLayoutId`),UNIQUE KEY `tagId` (`tagId`,`playlistId`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;"
    },
    {
      "step": "Additional fields for Playlist table",
      "action": "ALTER TABLE playlist ADD createdDt DATETIME NOT NULL;ALTER TABLE playlist ADD modifiedDt DATETIME NOT NULL;ALTER TABLE playlist ADD duration INT DEFAULT 0 NOT NULL;ALTER TABLE playlist ADD requiresDurationUpdate TINYINT DEFAULT 0 NOT NULL;"
    },
    {
      "step": "Add Playlist Module",
      "action": "INSERT INTO module (Module, Name, Enabled, RegionSpecific, Description, ImageUri, SchemaVersion, ValidExtensions, PreviewEnabled, assignable, render_as, settings, viewPath, class, defaultDuration) VALUES ('subplaylist', 'Sub-Playlist', 1, 1, 'Embed a Sub-Playlist', 'forms/library.gif', 1, null, 1, 1, 'native', null, '../modules', 'Xibo\\\\Widget\\\\SubPlaylist', 10);"
    },
    {
      "step": "Add Playlist closure table",
      "action": "CREATE TABLE IF NOT EXISTS `lkplaylistplaylist` (`parentId` int(11) NOT NULL,`childId` int(11) NOT NULL,`depth` int(11) NOT NULL,UNIQUE KEY `parentId` (`parentId`,`childId`,`depth`),UNIQUE KEY `childId` (`childId`,`parentId`,`depth`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;"
    },
    {
      "step": "Populate Playlist closure table",
      "action": "INSERT INTO lkplaylistplaylist (parentId, childId, depth) SELECT playlistId, playlistId, 0 FROM playlist;"
    }
  ]
}